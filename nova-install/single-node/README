# Malek Musleh
# mmusleh@isi.edu
# May. 14, 2013
#
# (c) 2013 USC/ISI
#
# README


## Included Files:
   - restart,.sh   # Script to restart all NOVA+Glance+KeyStone+Cidner Services
   - erase-all.sh  # Script to remove all dodcs/openstack/nova packages
   - clean.sh	   # Script to remove log files
   - OS-config.py  # Python File that contains routines for configuring MYSQL database
   - OS-install.sh # Main Script
   - helper.sh	   # Bash File that contains bash functions
   - config.yaml   # Configuration file for configuring dodcs-install

Note:
===
This installation script will install and configure services required
to start instances. If you want to use VNC console from the dashboard,
make sure to start openstack-nova-novncproxy and
openstack-nova-consoleauth. The script will install and configure these,
but it will not automatically start them. If you want to use Cinder (the
volume service), you will need to finish the configuration process
yourself as described in the installation manual. The script will
install the required packages, but you still have to decide on the
location of volumes on your system and adjust /etc/cinder/cinder.conf
accordingly. Also run 'cinder-manage db sync' to initialize the database.
===

## Prerequisites:

Installation of the following rpms:
1) libyaml-0.1.3-1.el6.x86_64.rpm
2) MYSQL-Python (MySQL-python-1.2.3-0.3.c1.1.el6.x86_64.rpm)
3) python-yaml (PyYAML-3.10-3.el6.x86_64.rpm for CentOS 6.3)

## Configuring:
# The config.yaml file is a simple configuration file where parameters
  can be set by the user. The more important ones to get going are the
  ISO file names + paths.

  a) ISO Paths + Namesneed to be specified
  b) Correct eth port name (default eth0) but user needs to double check
  c) Other parameters can be left to the default values
  d) Location of Image files: $IMAGE_LOC
  e) IP Address of Services: ${CC_ADDR} # Set to local IP Address


## Running

# Clean:
$ clear; bash ./OS-install.sh -F config.yaml -T clean

# Create backup:
$ clear; bash ./OS-install.sh -F config.yaml -T backup

# To start install:
$ clear; bash ./OS-install.sh -F config.yaml -T all

# The -T option has the following supported options:
# -clean: removes/uninstalls openstack
# -cleanmysql: removes/deletes users + databases
# -backup: creates backup of some important config files in case installation goes wrong
# -restore: restores the backup files to allow for re-running of install script 
# -all: installs everything
# -S: Step to restart installation process from

Note: By default the kernel upgrade step is disabled. To enable kernel upgrade during Installation, specify the -K flag on the command line.

# Restarting the installation if step failures

# To restart the installation process from a certain step number, instead of from the beginning, use the -S flag.
# The following command restarts the installation process from step 12

$ clear; bash ./OS-install.sh -F config.yaml -T all -S 12 


# Post-Installation

1) $ source /root/openrc (credentials file)
2) $ euca-describe-images (look for the kvm-fs image ID: ami-XXXXXXXX)
3) $ euca-run-instances -k userkey -t m1.tiny ami-XXXXXXXX
4) $ euca-describe-instances
5) First time launch of new image instance will have the status state in 'Pending' as it adds 
   the image to the instance directory